---
import DocLayout from "../layouts/DocLayout.astro";
import { Endpoint } from "../components/Endpoint.tsx";
import fs from "node:fs/promises";
import path from "node:path";
import { House, ChevronRight, Server } from "lucide-react";

const title = "API Endpoints";

let endpointFiles = [
  "auth-endpoints.json",
  "projects-endpoints.json",
  "users-endpoints.json",
];

let groups = [];

for (const file of endpointFiles) {
  try {
    const filePath = path.join(process.cwd(), "src/content/example-docs", file);
    const fileContent = await fs.readFile(filePath, "utf-8");
    const data = JSON.parse(fileContent);
    groups.push(data);
  } catch (error) {
    console.error(`Error reading ${file}:`, error);
  }
}
---

<DocLayout title={title}>
  <div
    class="h-full flex flex-col p-6 md:p-12 lg:px-16 lg:py-12 pt-20 md:pt-12 max-w-7xl mx-auto w-full"
  >
    {/* Breadcrumbs */}
    <nav
      class="flex items-center space-x-2 text-[13px] text-zinc-500 dark:text-zinc-400 mb-8"
      aria-label="Breadcrumb"
    >
      <a
        href="/"
        class="flex items-center gap-1.5 opacity-70 hover:opacity-100 transition-opacity"
      >
        <House size={14} />
        <span>Home</span>
      </a>
      <ChevronRight size={14} class="opacity-30" />
      <span class="opacity-70">Reference</span>
      <ChevronRight size={14} class="opacity-30" />
      <span class="text-zinc-900 dark:text-zinc-100 font-semibold">{title}</span
      >
    </nav>

    <div class="mb-12">
      <h1
        class="text-4xl font-extrabold tracking-tight text-zinc-900 dark:text-zinc-100 mb-4"
      >
        {title}
      </h1>
      <p class="text-lg text-zinc-600 dark:text-zinc-400 max-w-3xl">
        Complete guide to the available REST API endpoints for the project. Each
        section covers a specific domain of the application.
      </p>
    </div>

    <div class="space-y-16">
      {
        groups.length > 0 ? (
          groups.map((group) => (
            <section class="animate-in fade-in slide-in-from-bottom-4 duration-500">
              <div class="flex items-center gap-3 mb-6 border-b border-zinc-100 dark:border-zinc-800 pb-4">
                <div class="w-10 h-10 rounded-xl bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center text-blue-600 dark:text-blue-400">
                  <Server size={20} />
                </div>
                <div>
                  <h2 class="text-2xl font-bold text-zinc-900 dark:text-zinc-100 italic">
                    {group.title}
                  </h2>
                  <p class="text-sm text-zinc-500 dark:text-zinc-400">
                    {group.description}
                  </p>
                </div>
              </div>

              <div class="bg-white dark:bg-[#0a0a0a] border border-zinc-100 dark:border-zinc-800 rounded-2xl overflow-hidden shadow-sm">
                {group.endpoints.map((ep) => (
                  <Endpoint
                    method={ep.method}
                    path={ep.path}
                    description={ep.description}
                  />
                ))}
              </div>
            </section>
          ))
        ) : (
          <div class="p-12 text-center border-2 border-dashed border-zinc-200 dark:border-zinc-800 rounded-2xl">
            <p class="text-zinc-500 dark:text-zinc-400">
              No endpoint specifications found.
            </p>
          </div>
        )
      }
    </div>

    <div
      class="mt-20 p-8 rounded-2xl bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-100 dark:border-zinc-800"
    >
      <h3 class="text-lg font-bold text-zinc-900 dark:text-zinc-100 mb-2">
        Technical Note
      </h3>
      <p
        class="text-sm text-zinc-600 dark:text-zinc-400 leading-relaxed text-pretty"
      >
        All endpoints except `/login` require an authentication token. Use the
        `Authorization: Bearer <token
          >` header to make authenticated requests. The rate limit for the API
          is 100 requests per minute per IP.
        </token>
      </p>
    </div>
  </div>
</DocLayout>
